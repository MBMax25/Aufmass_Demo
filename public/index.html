<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Aufmaß – Demo PWA</title>
  <meta name="description" content="Aufmaß-Lösung für Fensterbauer – Demo PWA (PDF, offlinefähige App-Shell, API-ready)." />

  <!-- PWA basics -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192-maskable.png" />

  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="light">
  <header class="app-header">
    <div class="brand">
      <div class="logo-wrap">
        <img class="logo" src="assets/logo.svg" alt="Logo" onerror="this.src='assets/logo@2x.png'" />
      </div>
      <div class="app-title">Aufmaß&nbsp;Demo</div>
    </div>
    <div class="header-actions">
      <button id="connectionBadge" class="badge" type="button" title="Verbindungsstatus">Online</button>
      <button id="installBtn" class="btn btn-secondary" hidden>Installieren</button>
      <button id="demoGuideBtn" class="btn btn-ghost" title="Geführte Demo starten">Demo starten</button>
      <button id="printBtn" class="btn btn-primary" title="PDF anzeigen">Drucken/Speichern</button>
    </div>
  </header>

  <main class="container">
    <!-- Hinweis (CRM-Echtzeit) -->
    <aside class="info-banner" role="note">
      <strong>Hinweis:</strong> Kundendaten können in Echtzeit aus Ihrem vorhandenen CRM/ERP übernommen werden.
      In dieser Demo erfolgt die Eingabe manuell bzw. über „Testdaten“.
    </aside>

    <div class="form-wrapper">
      <form id="aufmassForm">
        <!-- Schritt 1: Kundendaten -->
        <fieldset id="kundendaten">
          <div class="legend-row">
            <legend>Kundendaten</legend>
            <button id="fillDemoBtn" class="btn btn-ghost" type="button">Testdaten</button>
          </div>

          <label><span>Firma:</span><input type="text" id="firma" name="firma" placeholder="Firma" autocomplete="organization" /></label>

          <div id="nameContainer">
            <label><span>Name:</span><input type="text" name="name" placeholder="Ansprechpartner/Name" autocomplete="name"/></label>
          </div>

          <div class="row-inline">
            <label style="flex:2;"><span>Straße:</span><input type="text" name="strasse" autocomplete="address-line1"/></label>
            <label style="flex:1;"><span>PLZ:</span><input type="text" name="plz" inputmode="numeric" autocomplete="postal-code"/></label>
            <label style="flex:1;"><span>Ort:</span><input type="text" name="ort" autocomplete="address-level2"/></label>
          </div>

          <div class="row-inline">
            <label style="flex:1;"><span>Telefon:</span><input type="text" name="telefon" autocomplete="tel"/></label>
            <label style="flex:1;"><span>E-Mail:</span><input type="email" name="email" autocomplete="email"/></label>
          </div>

          <div class="row-inline">
            <button type="button" id="btnToAuftragsdaten" class="btn btn-primary">Weiter</button>
          </div>
        </fieldset>

        <!-- Schritt 2: Auftragsdaten -->
        <fieldset id="auftragsdaten" style="display:none;">
          <legend>Auftragsdaten</legend>

          <div class="note-card">
            <strong>Hinweis:</strong> Alle zu erfassenden Daten, Maße und Produkteigenschaften
            können pro Kunde individuell angepasst werden (Beispiele unten).
          </div>

          <div class="row-inline">
            <label style="flex:none;"><span>Gebäudeart:</span></label>
            <label class="inline-radio-item"><input type="radio" name="gebaeudeart" value="Neubau" /> Neubau</label>
            <label class="inline-radio-item"><input type="radio" name="gebaeudeart" value="Altbau" /> Altbau</label>
          </div>

          <div class="section-divider"></div>

          <div class="row-inline">
            <label style="flex:none;"><span>Material:</span></label>
            <label class="inline-radio-item"><input type="radio" name="material" value="Holz" /> Holz</label>
            <label class="inline-radio-item"><input type="radio" name="material" value="Kunststoff" /> Kunststoff</label>
            <label class="inline-radio-item"><input type="radio" name="material" value="Alu" /> Alu</label>
          </div>

          <div class="section-divider"></div>

          <div class="row-inline">
            <label style="flex:none;"><span>Farbe:</span></label>
            <select name="farbe" id="farbeSelect">
              <option value="Anthrazit">Anthrazit</option>
              <option value="Weiß">Weiß</option>
              <option value="Grau">Grau</option>
              <option value="Sonstige">Sonstige</option>
            </select>
            <input type="text" name="farbeSonstige" id="farbeSonstige" placeholder="Farbname" style="display:none; width:auto;" />
            <span id="farbeSwatches" class="swatches" aria-hidden="true"></span>
          </div>

          <div class="section-divider"></div>

          <div class="row-inline">
            <label style="flex:none;"><span>Glas:</span></label>
            <label class="inline-radio-item"><input type="radio" name="glas" value="1:1" /> 1:1</label>
            <label class="inline-radio-item"><input type="radio" name="glas" value="3-fach" /> 3-fach</label>
          </div>

          <div class="section-divider"></div>

          <div class="row-inline">
            <label style="flex:none;"><span>FBA:</span></label>
            <label class="inline-radio-item"><input type="radio" name="fba" value="Ja" /> Ja</label>
            <label class="inline-radio-item"><input type="radio" name="fba" value="Nein" /> Nein</label>
          </div>

          <!-- Eingabearten (Test) -->
          <div class="card soft">
            <div class="card-title">Eingabearten (Test)</div>
            <div class="row-inline">
              <label><span>Dropdown:</span>
                <select><option>Option A</option><option>Option B</option><option>Option C</option></select>
              </label>
              <label class="inline-checkbox-item"><input type="checkbox" /> Checkpoint</label>
              <label class="inline-radio-item"><input type="radio" name="wahltest" /> Auswahl</label>
            </div>
          </div>

          <div class="row-inline">
            <button type="button" id="btnBackToKundendaten" class="btn btn-secondary">Zurück</button>
            <button type="button" id="btnToFensterbereich" class="btn btn-primary">Weiter</button>
          </div>
        </fieldset>

        <!-- Schritt 3: Fensteraufmaß -->
        <fieldset id="fensterbereich" style="display:none;">
          <legend>Fensteraufmaß</legend>

          <div class="note-card">
            <strong>Hinweis:</strong> Räume anlegen → pro Raum Fenster hinzufügen → Maße eintragen oder messen →
            Fotos/Skizze ergänzen → „Drucken/Speichern“.
          </div>

          <div id="raeumeContainer"></div>
          <button type="button" class="add-btn btn btn-ghost" id="addRaumBtn">+ Raum hinzufügen</button>

          <div class="row-inline" style="justify-content:flex-start; margin-top:1.5em;">
            <button type="button" id="btnBackToAuftragsdaten" class="btn btn-secondary">Zurück</button>
            <button type="submit" id="submitButton" class="btn btn-primary">Drucken/Speichern</button>
          </div>

          <div id="loadingBar" class="loading" style="display:none;">
            ⏳ Aufmaßprotokoll wird erstellt …
          </div>
        </fieldset>
      </form>

      <!-- Abschlussseite -->
      <div id="abschlussSeite" style="display:none; text-align:center; margin-top:2em;">
        <h2>✅ Aufmaß erfolgreich erfasst</h2>
        <p>PDF wurde in einem neuen Tab geöffnet.</p>
        <img src="https://cdn-icons-png.flaticon.com/512/553/553416.png" width="140" alt="Erfolg" style="margin-top:1em;" />
        <br /><br />
        <button type="button" id="newAufmassBtn" class="btn btn-primary">Weiteres Aufmaß erstellen</button>
      </div>
    </div>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite" hidden></div>

  <noscript>Bitte JavaScript aktivieren – diese Demo benötigt JS.</noscript>

  <!-- pdf-lib lokal (mit Cache-Bust) -->
  <script src="vendor/pdf-lib.min.js?v=5"></script>
  <script src="app.js" defer></script>
  <script src="pdf.js" defer></script>
</body>
</html>
